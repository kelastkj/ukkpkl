<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PPSP</title>
  <link rel="icon" href="logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js"></script>
  <style>
    :root { color-scheme: light; }
  /* Layout A4 untuk print */
  @page { size: A4; margin: 12mm; }
  @page :first { margin: 0.5cm 12mm 12mm 12mm; }
    @media print {
      #toolbar { display: none !important; }
      body { background: #fff !important; }
      .sheet { box-shadow: none !important; margin: 0 !important; }
      .avoid-break { page-break-inside: avoid; break-inside: avoid; }
        /* Untuk cetak: perlu lebar label lebih besar agar teks panjang (mis. TUK) tidak tumpang tindih */
        .grid-detail { grid-template-columns: 95mm auto !important; }
        .grid-detail .label { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      /* Paksa ukuran huruf 12pt saat cetak */
      body, body * { font-size: 12pt !important; }
    }
    body { background: rgb(248 250 252); font-size: 12pt; }
    .sheet {
      width: 210mm; min-height: 297mm; background: white;
      margin: 12px auto; box-shadow: 0 10px 25px rgba(0,0,0,.08);
    }
    .doc-title { letter-spacing: .2px; }
    .table th, .table td { border: 1px solid #000; }
    .table th { background: #f8fafc; }
  /* Hindari pemotongan baris tabel saat cetak */
  thead { display: table-header-group; }
  tfoot { display: table-row-group; }
  tr { page-break-inside: avoid; break-inside: avoid; }
    .inp { width: 100%; border-bottom: 1px dashed rgb(148 163 184); padding: 2px 4px; }
    .narrow { width: 16mm; }
    .row-h { height: 28px; }
    .muted { color: #4b5563; }
    .page-break { page-break-before: always; }
  .grid-detail { grid-template-columns: 80mm auto; column-gap: 4mm; }
  .nowrap { white-space: nowrap; }
  .label { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .grid-detail .value { padding-left: 4px; }
  /* Hindari pemisahan bagian penting saat cetak */
  .avoid-break { page-break-inside: avoid; break-inside: avoid; -webkit-region-break-inside: avoid; }
  /* Hilangkan layout samping, gunakan tumpuk vertikal */
  .mt-1em { margin-top: 1em; }
  .title-upk { font-weight: 800; font-size: 16pt; }
  /* toolbar styling removed - use Tailwind utility classes for navbar */
  </style>
</head>
<body class="text-slate-800">

  <!-- Tidak ada toolbar/nav untuk versi cetak otomatis -->

  <!-- Sheet: Halaman Gabungan (penilaian + keterangan) -->
  <!-- Navbar tipis di bagian atas (menggunakan Tailwind). Tersembunyi saat cetak -->
  <div id="toolbar" class="fixed top-0 left-0 right-0 z-50 bg-white border-b print:hidden">
    <div class="max-w-4xl mx-auto px-4 py-2 flex items-center">
      <div class="text-sm text-slate-700 font-medium">PPSP</div>
      <div class="ml-auto">
        <button id="printBtn" title="Cetak dokumen" class="inline-flex items-center gap-2 bg-sky-600 hover:bg-sky-700 text-white text-sm font-semibold px-3 py-1 rounded shadow-sm">Cetak</button>
      </div>
    </div>
  </div>

  <!-- Spacer agar konten tidak tertutup navbar fixed (disembunyikan saat cetak) -->
  <div class="h-12 print:hidden"></div>

    <div class="sheet">
    <div class="p-6 md:p-8">
      <!-- Bagian atas: Identitas + Tabel Penilaian -->
  <div class="mt-2 avoid-break">
          <!-- Judul Dokumen -->
          <div class="text-center leading-tight">
            <div class="title-upk">UJI KOMPETENSI KEAHLIAN</div>
            <div class="title-upk">TAHUN PELAJARAN <span id="tapel">2025/2026</span></div>
            <div class="mt-2 font-bold">LEMBAR PENILAIAN</div>
            <div class="font-bold">UJIAN PRAKTIK KEJURUAN</div>
          </div>

          <!-- Detail Satuan/Mitra -->
          <div class="mt-3 text-sm grid grid-detail gap-y-1">
            <div class="nowrap">Satuan Pendidikan</div><div class="value">: <span id="satuan">SMKN 1 Telagasari</span></div>
            <div class="nowrap">Kompetensi/Konsentrasi Keahlian</div><div class="value">: <span id="konsentrasi">Teknik Komputer Jaringan</span></div>
            <div class="label">Tempat Uji Konsentrasi Keahlian (TUK)</div><div class="value">: <span id="mitra">-</span></div>
            <div class="nowrap">Bentuk Soal</div><div class="value">: <span id="bentuk">Penguasaan Perorangan</span></div>
            <div class="nowrap">Nama Peserta</div><div class="value">: <span id="nama">...................................................</span></div>
          </div>

          <!-- Tabel Elemen Kompetensi -->
          <div class="mt-3">
            <table class="min-w-full table text-[12px]">
              <thead>
                <tr class="text-center">
                  <th class="px-2 py-1 align-middle" style="width:10mm" rowspan="2">No</th>
                  <th class="px-2 py-1 align-middle" rowspan="2">ELEMEN KOMPETENSI</th>
                  <th class="px-2 py-1 text-center" colspan="2">Capaian</th>
                  <th class="px-2 py-1 align-middle" style="width:50mm" rowspan="2">Catatan</th>
                </tr>
                <tr class="text-center">
                  <th class="px-2 py-1" style="width:35mm">Kompeten</th>
                  <th class="px-2 py-1" style="width:35mm">Belum Kompeten</th>
                </tr>
                <tr class="text-center text-[11px]">
                  <th class="px-2 py-1">1</th>
                  <th class="px-2 py-1">2</th>
                  <th class="px-2 py-1">3</th>
                  <th class="px-2 py-1">4</th>
                  <th class="px-2 py-1">5</th>
                </tr>
              </thead>
              <tbody id="rows"></tbody>
            </table>

            <!-- Kriteria penentuan kesimpulan akhir (ditempatkan langsung di bawah tabel agar menyatu saat cetak) -->
            <div class="mt-3">
              <div class="font-semibold">Kriteria penentuan kesimpulan akhir :</div>
              <table class="min-w-full table text-[12px] mt-2" style="border-collapse: collapse;">
                <thead>
                  <tr>
                    <th class="px-2 py-1 text-left" style="width:40mm;">Kesimpulan</th>
                    <th class="px-2 py-1 text-left">Kriteria</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="px-2 py-1">Kompeten</td>
                    <td class="px-2 py-1">Apabila <strong>sudah memenuhi sebagian besar</strong> kriteria pada elemen kompetensi.</td>
                  </tr>
                  <tr>
                    <td class="px-2 py-1">Belum Kompeten</td>
                    <td class="px-2 py-1">Apabila <strong>belum memenuhi sebagian besar</strong> kriteria pada elemen kompetensi.</td>
                  </tr>
                </tbody>
              </table>
    <!-- Penjelasan tambahan, tanda tangan, dan catatan kaki (tetap di bawah Kriteria yang diposisikan sebelumnya) -->
    <div class="mt-6 text-[12px]">
        <!-- Penjelasan tambahan -->
        <div class="mb-4">
          <div class="font-semibold mb-1">Keterangan :</div>
          <ul class="ml-5 list-disc space-y-1">
            <li>Capaian kompetensi peserta uji dituliskan dalam bentuk ceklis (âˆš).</li>
            <li>Kesimpulan capaian kompetensi peserta uji, dihasilkan dalam bentuk <strong>pernyataan*</strong> (pilih salah satu).</li>
            <li>Jika peserta uji direkomendasikan belum kompeten, maka peserta uji diberi kesempatan untuk mengulang.</li>
            <li>Catatan diberikan sebagai keterangan tambahan yang diperlukan untuk memperkuat kesimpulan.</li>
          </ul>
        </div>

        <!-- Tanda tangan dan tanggal -->
          <div class="mt-4 avoid-break" style="display: flex; justify-content: space-between; align-items: flex-start; gap: 12mm;">
          <div style="flex:1; display: grid; grid-template-rows: auto auto auto auto auto auto; align-items: start;">
            <div style="height:36px;"></div>
            <div></div>
            <div></div>
            <div class="text-center"><br>Penguji UKK</div>
            <div style="height:30px;"></div>
            <div class="text-center"><br>......................................................</div>
          </div>
          <div style="flex:1; display: grid; grid-template-rows: auto auto auto auto auto auto; align-items: start;">
            <div style="height:36px;"></div>
            <div style="text-align: right;">........................................., .......................... <span id="ttdYear">2025</span></div>
            <div></div>
            <div class="text-center">Pejabat Yang Bertanda Tangan<br/>Di Sertifikat</div>
            <div style="height:30px;"></div>
            <div class="text-center">......................................................</div>
          </div>
        </div>

        <!-- Catatan kaki -->
        <div class="mt-4 text-[11px]">
          <div><em>Catatan :</em></div>
          <div class="mt-1 text-[11px]">
            <div>* Jika Pejabat yang bertanda tangan sama dengan <strong>Penguji UKK</strong>, maka cukup isi nama, tanda tangan, dan stempel pada Pejabat yang bertanda tangan di sertifikat.</div>
            <div>* Sertakan bukti dokumentasi pelaksanaan UKK di DUDI persiswa.</div>
            <div>* Bukti Dokumentasi dikirimkan Via WA/Email ke masing-masing guru pembimbing PKL dari SMKN 1 Telagasari.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Helpers
    const $ = (s, r=document) => r.querySelector(s);
    const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
    function getAllParams(){ return new URLSearchParams(location.search); }

    function parseKompetensi(params){
      // dukung beberapa cara pengiriman: komp=...&komp=... atau komp1, komp2, atau kompjson (JSON-encoded array)
      const list = [];
      params.forEach((v,k)=>{ if(k.toLowerCase()==='komp') list.push(v); });
      if(!list.length){
        // cek komp1, komp2...
        const arr = [];
        params.forEach((v,k)=>{ if(/^komp\d+$/i.test(k)) arr.push({k, v}); });
        arr.sort((a,b)=> parseInt(a.k.replace(/\D/g,'')) - parseInt(b.k.replace(/\D/g,'')) );
        arr.forEach(x=>list.push(x.v));
      }
      if(!list.length && params.get('kompjson')){
        try { const j = JSON.parse(decodeURIComponent(params.get('kompjson'))); if(Array.isArray(j)) j.forEach(x=>list.push(String(x))); } catch {}
      }
      return list.filter(Boolean);
    }

    function renderRows(kompetensi){
      const tbody = $('#rows');
      tbody.innerHTML = '';
      // Jika tidak ada data kompetensi, gunakan daftar default sesuai gambar contoh (8 item)
      const defaultList = [
        'Mempersiapkan komputer serta menghidupkan/mematikan perangkat sesuai prosedur',
        'Mengoperasikan sistem operasi komputer',
        'Mengoperasikan perangkat lunak aplikasi perkantoran',
        'Melakukan instalasi sistem operasi dan software aplikasi',
        'Melakukan pemeliharaan dasar komputer, backup, restore, dll.',
        'Menerima dan menindaklanjuti permintaan pengguna terkait masalah IT',
        'Memberikan panduan penggunaan perangkat IT kepada pengguna',
        'Pengaplikasian dan tata cara penggunaan aplikasi ipalms mobile'
      ];
      const rows = (kompetensi && kompetensi.length) ? kompetensi.slice() : defaultList.slice();
      rows.forEach((text, i) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="px-2 text-center">${i+1}</td>
          <td class="px-2">${text || '&nbsp;'}</td>
          <td class="px-2">&nbsp;</td>
          <td class="px-2">&nbsp;</td>
          <td class="px-2">&nbsp;</td>
        `;
        tbody.appendChild(tr);
      });
      // Tambahkan baris footer (tfoot) untuk Kesimpulan Akhir seperti pada gambar
      const table = tbody.closest('table');
      // Hapus tfoot lama jika ada
      const oldTfoot = table.querySelector('tfoot'); if(oldTfoot) oldTfoot.remove();
      const tfoot = document.createElement('tfoot');
      tfoot.innerHTML = `
        <tr>
          <td class="px-2 py-1"></td>
          <td class="px-2 py-1 font-semibold">Kesimpulan Akhir</td>
          <td class="px-2 py-1 text-center" colspan="3">Belum Kompeten/Kompeten*</td>
        </tr>
      `;
      table.appendChild(tfoot);
    }

    function initMeta(){
      const p = getAllParams();
      const tapel = p.get('tapel') || '2025/2026';
      const satuan = p.get('satuan') || 'SMKN 1 Telagasari';
      const mitra = p.get('mitra') || '-';
      const kons = p.get('konsentrasi') || 'Teknik Komputer Jaringan';
      const bentuk = p.get('bentuk') || 'Penguasaan Perorangan';
      const nama = p.get('nama') || '';

      $('#tapel').textContent = tapel;
      $('#satuan').textContent = satuan;
      $('#mitra').textContent = mitra;
      $('#konsentrasi').textContent = kons;
      $('#bentuk').textContent = bentuk;
      $('#nama').textContent = nama || '...................................................';
  // Tanggal/kota pada area tanda tangan dibiarkan kosong (titik-titik) sesuai permintaan

      const komp = parseKompetensi(p);
      renderRows(komp);

      // Set dokumen title: PPSP - Nama Industri (Mitra)
      const titleMitra = (mitra && mitra !== '-') ? ` - ${mitra}` : '';
      document.title = `PPSP${titleMitra}`;

      // Set tahun pada tanda tangan: gunakan 2025 atau akhir dari tahun pelajaran jika cocok pola "YYYY/YYYY"
      let year = 2025;
      const m = /^(\d{4})\/(\d{4})$/.exec(tapel.trim());
      if (m) {
        // Gunakan tahun kedua dari tapel, namun jika user minta 2025 secara eksplisit, prioritaskan 2025
        const parsed = parseInt(m[2], 10);
        year = Number.isFinite(parsed) ? parsed : year;
      }
      // Override ke 2025 sesuai permintaan terbaru
      year = 2025;
      const ttdYearEl = document.getElementById('ttdYear');
      if (ttdYearEl) ttdYearEl.textContent = String(year);
    }

    (function(){
      initMeta();
      // Auto print setelah render agar langsung cetak saat dibuka
      setTimeout(()=>{ try{ window.print(); }catch(e){} }, 300);

      // Hubungkan tombol cetak pada toolbar (jika ada)
      const printBtn = document.getElementById('printBtn');
      if (printBtn) printBtn.addEventListener('click', ()=>{ try{ window.print(); }catch(e){} });
    })();
  </script>
</body>
</html>
